<!doctype html>
<!-- cite: syntagmatic, davies, reed, heinrich -->

<!-- Goals:
      - split single data set into two ranges for each plot
      - look at gold and implement hover bar (done, check slick_load)
      - linked pc plots (done)
      - color scheme (done)
      - uploader (done)
      - white text bg (still not sure if it works outside firefox;
        note: Gold's method is the same but he's using a seperate
        stylesheet, maybe that's the trick)
 -->

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
  <link rel="stylesheet" type="text/css" href="../d3.parcoords.css">
  <link rel="stylesheet" type="text/css" href="style.css">

  <title>Parallel Coordinates Testbed</title>

  <style>
    /* white text shadow on ticks */

    svg {
      font: 10px sans-serif;
    }

    .axis text {
      text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
      cursor: move;
    }
  </style>

</head>

<body>
  <script src="lib/d3.js"></script>
  <script src="../d3.parcoords.js"></script>
  <script src="lib/colorbrewer_schemes.js"></script>

  <h1>Parallel Coordinates</h1>
  <p>Basic parallel coordinates plot testbed.</p>
  <input type="file" id="uploader">
  <p>
    <button id="brush-reset">Reset Brushes</button>
  </p>
  <!-- Setup page
  <div id="nav"></div>
  <titles, direction to tutorials, etc.>
  <div id="main"></div>
  <buttons, summaries (pie chart?), etc>
  -->
  <div id="row-1" class="parcoords" style="height:240px;"></div>
  <div id="row-2" class="parcoords" style="height:240px;"></div>


  <script>
    // Plots
    // -----------------------------------------------

    // define color palette for discrete, catagorical data using ColorBrewer
    var color_scheme = d3.scale.ordinal()
      .domain(['3', '4', '5', '6', '7', '8']) // map each color with catagorical
      .range(colorbrewer.Dark2[6]) // choose color scheme and pick N colors

    // define colors based on catagorical variable
    var colors = function(d) {
      return color_scheme(d['cylinders']);
    };

    // Future Work:
    // (allow user to choose between catagorical and continuous,
    //  then let them choose the variable axis)

    // define parallel coordinates variable
    var pc1 = d3.parcoords()("#row-1")
      .alpha(0.4)
      .color(colors)
      .height(240)
      // .height(d3.max([document.body.clientHeight-326, 180]))
      .margin({
        top: 16,
        left: 16,
        right: 16,
        bottom: 16
      });

    var pc2 = d3.parcoords()("#row-2")
      .alpha(0.4)
      .color(colors)
      .height(240)
      // .height(d3.max([document.body.clientHeight-326, 180]))
      .margin({
        top: 16,
        left: 16,
        right: 16,
        bottom: 16
      });

    // create charts from loaded data
    function parallelCoordinates(data) {

      pc1
        .data(data) // select column range
        //.hideAxis(["name"]) // generalize this
        .render().mode("queue")
        .shadows()
        .reorderable()
        .brushMode("1D-axes")
        .on("brush", function(brushed) {
          if (pc2 !== pc1) {
            //pc2.brushReset(); //reset not necessary, but brushes not maintained between plots
            pc2.brushed(brushed);
            pc2.render().mode("queue");
          }
        });


      pc2
        .data(data) // select column range
        //.hideAxis(["name"]) // generalize this
        .render().mode("queue")
        .reorderable()
        .brushMode("1D-axes")
        .shadows()
        .on("brush", function(brushed) {
          if (pc1 !== pc2) {
            //pc1.brushReset();
            pc1.brushed(brushed);
            pc1.render().mode("queue");
          }
        });

    };

    // reset brushes
    d3.select('#brush-reset').on('click', function() {
      pc1.brushReset();
      pc2.brushReset();
    })

    // CSV Uploader
    // -----------------------------------------------
    var uploader = document.getElementById("uploader");
    var reader = new FileReader();

    reader.onload = function(e) {
      var contents = e.target.result;
      var data = d3.csv.parse(contents);

      data.forEach(function(car) {
        // find a way to generalize the removal of unwanted axis?
        delete car.name;
        delete car.year;
      });

      parallelCoordinates(data);

      // remove button, since re-initializing doesn't work for now
      uploader.parentNode.removeChild(uploader);
    };

    uploader.addEventListener("change", handleFiles, false);

    function handleFiles() {
      var file = this.files[0];
      reader.readAsText(file);
    };
  </script>
</body>
<html>

<!--
Development Comments:

When we want to really customize each axis (e.g. tick position on left),
look into parcoords.dimensions API

Future Work:
(allow user to choose between catagorical and continuous,
then let them choose the variable axis)



-->
